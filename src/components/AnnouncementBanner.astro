---
// Unobtrusive banner that opens modal on click
interface Props {
	lang: 'en' | 'ko';
}

const { lang } = Astro.props;

const t = {
	ko: {
		bannerTitle: '신주발행공고',
		bannerSubtitle: '- 클릭하여 자세히 보기',
		modalTitle: '신주발행공고',
		intro: '2025년 12월 23일 개최한 당사 이사회결의로 3자배정 유상증자를 결의하였으므로 상법 제418조 및 당사 정관규정에 의거하여 아래와 같이 공고 합니다.',
		items: [
			{ label: '신주의 종류와 수', value: '기명식 상환전환우선주식 50,736주' },
			{ label: '신주의 발행가액', value: '1주당 39,420원' },
			{ label: '신주의 납입기일(예정일)', value: '2026년 01월 08일' },
			{ label: '신주배정방법', value: '상법 제418조 및 당사 정관 의거하여 발행주식 전부를 3자에게 배정한다.' },
			{ label: '기타사항', value: '기타 신주발행에 필요한 사항은 대표이사에게 일임한다.' },
		],
		date: '2025년 12월 23일',
		signature: '주식회사 오믹스에이아이 대표이사 신동명',
		confirm: '확인',
	},
	en: {
		bannerTitle: 'New Share Issuance Notice',
		bannerSubtitle: '- Click for details',
		modalTitle: 'New Share Issuance Notice',
		intro: 'The Board of Directors resolved on December 23, 2025 to issue new shares through a third-party allotment. In accordance with Article 418 of the Commercial Act and the company\'s Articles of Incorporation, we hereby announce the following:',
		items: [
			{ label: 'Type and Number of New Shares', value: '50,736 Redeemable Convertible Preferred Shares' },
			{ label: 'Issue Price per Share', value: 'KRW 39,420' },
			{ label: 'Payment Date (Expected)', value: 'January 8, 2026' },
			{ label: 'Allocation Method', value: 'All shares to be allocated to third parties pursuant to Article 418 of the Commercial Act and the company\'s Articles of Incorporation.' },
			{ label: 'Other Matters', value: 'Other matters necessary for the issuance of new shares are delegated to the CEO.' },
		],
		date: 'December 23, 2025',
		signature: 'Dongmyung Shin, CEO, OmixAI Inc.',
		confirm: 'OK',
	},
};

const text = t[lang];
---

<!-- Banner -->
<button id="announcement-banner" class="fixed top-0 left-0 right-0 z-[60] bg-[#1e3a4c] text-white/90 text-sm cursor-pointer hover:bg-[#254555] transition-colors w-full text-left px-4 pt-2 pb-2.5 block">
	<div class="max-w-7xl mx-auto">
		<div class="flex items-center gap-2">
			<svg class="w-4 h-4 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
			</svg>
			<span class="font-medium">{text.bannerTitle}</span>
			<span class="text-white/70 text-xs hidden sm:inline">{text.bannerSubtitle}</span>
		</div>
	</div>
</button>

<!-- Modal -->
<div id="announcement-modal" class="fixed inset-0 z-[100] hidden">
	<div id="modal-backdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
	<div id="modal-wrapper" class="absolute inset-0 flex items-center justify-center p-4">
		<div id="modal-content" class="relative bg-[var(--bg-card)] border border-subtle rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-auto" onclick="event.stopPropagation()">
			<!-- Header -->
			<div class="sticky top-0 bg-[var(--brand-teal)] text-white px-6 py-4 rounded-t-2xl">
				<div class="flex items-center justify-between">
					<div class="flex items-center gap-3">
						<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
						</svg>
						<h2 class="text-xl font-semibold">{text.modalTitle}</h2>
					</div>
					<button id="modal-close" class="p-1.5 hover:bg-white/20 rounded-lg transition-colors" aria-label="Close">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
						</svg>
					</button>
				</div>
			</div>

			<!-- Content -->
			<div class="px-6 py-5 text-body text-sm leading-relaxed">
				<p class="mb-4">{text.intro}</p>

				<ol class="list-decimal list-inside space-y-2 mb-5 text-body">
					{text.items.map((item) => (
						<li><span class="text-muted">{item.label}:</span> {item.value}</li>
					))}
				</ol>

				<div class="pt-4 border-t border-subtle text-muted text-xs">
					<p>{text.date}</p>
					<p>{text.signature}</p>
				</div>
			</div>

			<!-- Footer -->
			<div class="px-6 py-4 border-t border-subtle bg-[var(--bg-section-alt)] rounded-b-2xl">
				<button id="modal-confirm" class="w-full py-3 rounded-full font-medium bg-[var(--bg-card)] border border-subtle text-body hover:bg-[var(--bg-section)] transition-colors">
					{text.confirm}
				</button>
			</div>
		</div>
	</div>
</div>

<style>
	#modal-content {
		animation: modal-in 0.2s ease-out;
	}
	@keyframes modal-in {
		from {
			opacity: 0;
			transform: translateY(10px) scale(0.98);
		}
		to {
			opacity: 1;
			transform: translateY(0) scale(1);
		}
	}
</style>

<script>
	const banner = document.getElementById('announcement-banner');
	const modal = document.getElementById('announcement-modal');
	const modalWrapper = document.getElementById('modal-wrapper');
	const modalClose = document.getElementById('modal-close');
	const modalConfirm = document.getElementById('modal-confirm');
	const header = document.getElementById('header');
	const main = document.querySelector('main');

	function updateLayoutForBanner() {
		if (!banner || !header) return;
		const bannerHeight = banner.offsetHeight;
		const headerHeight = 80; // Base header height
		header.style.top = bannerHeight + 'px';
		if (main) {
			main.style.paddingTop = (bannerHeight + headerHeight) + 'px';
		}
	}

	function openModal() {
		if (modal) {
			modal.classList.remove('hidden');
			document.body.style.overflow = 'hidden';
		}
	}

	function closeModal() {
		if (modal) {
			modal.classList.add('hidden');
			document.body.style.overflow = '';
		}
	}

	// Update layout after render and fonts load
	requestAnimationFrame(() => {
		updateLayoutForBanner();
		setTimeout(updateLayoutForBanner, 100);
	});
	document.fonts?.ready.then(updateLayoutForBanner);

	// Event listeners
	banner?.addEventListener('click', openModal);
	modalClose?.addEventListener('click', closeModal);
	modalConfirm?.addEventListener('click', closeModal);
	modalWrapper?.addEventListener('click', closeModal);

	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape' && modal && !modal.classList.contains('hidden')) {
			closeModal();
		}
	});

	window.addEventListener('resize', updateLayoutForBanner);
</script>

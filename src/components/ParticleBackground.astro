---
// Particle Background Component using tsparticles
// Creates an animated particle network with mouse interaction
---

<div id="particles-container"></div>

<style>
	#particles-container {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: 0;
		pointer-events: auto;
	}
</style>

<script>
	import { tsParticles } from "@tsparticles/engine";
	import { loadSlim } from "@tsparticles/slim";

	// Theme-aware color configs
	const darkColors = {
		particles: ["#31c27c", "#1ea4a1", "#1a5fbe"],
		links: "#1ea4a1",
		linksOpacity: 0.2,
		twinkle: "#ffffff",
	};

	const lightColors = {
		particles: ["#16a34a", "#0d9488", "#2563eb"],
		links: "#0d9488",
		linksOpacity: 0.15,
		twinkle: "#1ea4a1",
	};

	function getColors() {
		const isLight = document.documentElement.getAttribute("data-theme") === "light";
		return isLight ? lightColors : darkColors;
	}

	async function initParticles() {
		await loadSlim(tsParticles);
		const colors = getColors();

		const container = await tsParticles.load({
			id: "particles-container",
			options: {
				fullScreen: false,
				background: {
					color: {
						value: "transparent",
					},
				},
				fpsLimit: 60,
				particles: {
					number: {
						value: 175,
						density: {
							enable: true,
							area: 800,
						},
					},
					color: {
						value: colors.particles,
					},
					shape: {
						type: "circle",
					},
					opacity: {
						value: 0.5,
						random: {
							enable: true,
							minimumValue: 0.3,
						},
					},
					size: {
						value: 2,
						random: {
							enable: true,
							minimumValue: 1,
						},
					},
					links: {
						enable: true,
						distance: 150,
						color: colors.links,
						opacity: colors.linksOpacity,
						width: 2,
					},
					move: {
						enable: true,
						speed: {
							min: 0.1,
							max: 0.8,
						},
						direction: "none",
						random: true,
						straight: false,
						outModes: {
							default: "out",
						},
					},
					twinkle: {
						particles: {
							enable: true,
							frequency: 0.01,
							opacity: 1,
							color: {
								value: colors.twinkle,
							},
						},
					},
				},
				interactivity: {
					detectsOn: "window",
					events: {
						onHover: {
							enable: true,
							mode: ["grab", "connect"],
						},
						resize: {
							enable: true,
						},
					},
					modes: {
						grab: {
							distance: 250,
							links: {
								opacity: 0.6,
								color: "#f59e0b",
							},
						},
						connect: {
							distance: 150,
							links: {
								opacity: 0.4,
							},
							radius: 200,
						},
					},
				},
				detectRetina: true,
			},
		});

		// Custom effect: change particle color when near cursor
		if (container) {
			const canvas = document.getElementById("particles-container");
			canvas?.addEventListener("mousemove", (e) => {
				const rect = canvas.getBoundingClientRect();
				const mouseX = e.clientX - rect.left;
				const mouseY = e.clientY - rect.top;

				container.particles.quadTree.queryCircle(
					{ x: mouseX, y: mouseY },
					150
				).forEach((p) => {
					if (p.particle) {
						p.particle.color.value = { r: 245, g: 158, b: 11 }; // amber
					}
				});
			});

			// Re-init on theme change
			const observer = new MutationObserver((mutations) => {
				mutations.forEach((mutation) => {
					if (mutation.attributeName === "data-theme") {
						container.destroy();
						initParticles();
					}
				});
			});
			observer.observe(document.documentElement, { attributes: true });
		}
	}

	// Initialize when DOM is ready
	if (document.readyState === "loading") {
		document.addEventListener("DOMContentLoaded", initParticles);
	} else {
		initParticles();
	}
</script>

---
import '../styles/global.css';
import Layout from '../components/Layout.astro';
import { getTranslations } from '../content/translations';

const t = getTranslations('en');
---

<Layout lang="en" title={`${t.contact.title} - OmixAI`} currentPage="contact" lightHeader={false}>
	<!-- Hero Section -->
	<section class="bg-section-alt py-16">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<h1 class="text-3xl md:text-4xl text-heading animate-fade-in-up">
				{t.contact.title}
			</h1>
		</div>
	</section>

	<!-- Contact Information & Map Section -->
	<section class="py-12 bg-section">
		<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

			<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
				<!-- Left Column: Order Form + Contact Info -->
				<div class="space-y-8">
					<!-- Order Form -->
					<div class="animate-fade-in-up">
						<div class="mb-6">
							<h2 class="text-2xl md:text-3xl text-heading mb-2">
								{t.contact.form.title}
							</h2>
							<p class="text-body text-sm">
								{t.contact.form.subtitle}
							</p>
						</div>

						<form id="order-form" class="glass-card rounded-xl p-6">
							<!-- Sample Type -->
							<div class="mb-4">
								<label for="sample-type" class="block text-body text-sm mb-2">
									{t.contact.form.fields.sampleType.label} <span class="text-red-400">*</span>
								</label>
								<select
									id="sample-type"
									name="sample_type"
									required
									class="w-full px-4 py-2.5 rounded-lg bg-[var(--bg-input)] text-body border border-subtle focus:border-emphasis focus:outline-none focus:ring-2 focus:ring-[var(--brand-teal)]/50 transition-all text-sm"
								>
									<option value="">{t.contact.form.fields.sampleType.placeholder}</option>
									<option value="cell-culture">{t.contact.form.fields.sampleType.options.cellCulture}</option>
									<option value="tissue">{t.contact.form.fields.sampleType.options.tissue}</option>
									<option value="blood">{t.contact.form.fields.sampleType.options.blood}</option>
									<option value="custom">{t.contact.form.fields.sampleType.options.custom}</option>
								</select>
							</div>

							<!-- Name -->
							<div class="mb-4">
								<label for="name" class="block text-body text-sm mb-2">
									{t.contact.form.fields.name.label} <span class="text-red-400">*</span>
								</label>
								<input
									type="text"
									id="name"
									name="from_name"
									required
									placeholder={t.contact.form.fields.name.placeholder}
									class="w-full px-4 py-2.5 rounded-lg bg-[var(--bg-input)] text-body border border-subtle focus:border-emphasis focus:outline-none focus:ring-2 focus:ring-[var(--brand-teal)]/50 transition-all text-sm"
								/>
							</div>

							<!-- Email -->
							<div class="mb-4">
								<label for="email" class="block text-body text-sm mb-2">
									{t.contact.form.fields.email.label} <span class="text-red-400">*</span>
								</label>
								<input
									type="email"
									id="email"
									name="reply_to"
									required
									placeholder={t.contact.form.fields.email.placeholder}
									class="w-full px-4 py-2.5 rounded-lg bg-[var(--bg-input)] text-body border border-subtle focus:border-emphasis focus:outline-none focus:ring-2 focus:ring-[var(--brand-teal)]/50 transition-all text-sm"
								/>
							</div>

							<!-- CC Email (optional) -->
							<div class="mb-4">
								<label for="cc" class="block text-body text-sm mb-2">
									{t.contact.form.fields.cc.label}
								</label>
								<input
									type="email"
									id="cc"
									name="cc_email"
									placeholder={t.contact.form.fields.cc.placeholder}
									class="w-full px-4 py-2.5 rounded-lg bg-[var(--bg-input)] text-body border border-subtle focus:border-emphasis focus:outline-none focus:ring-2 focus:ring-[var(--brand-teal)]/50 transition-all text-sm"
								/>
							</div>

							<!-- Message (optional) -->
							<div class="mb-4">
								<label for="message" class="block text-body text-sm mb-2">
									{t.contact.form.fields.message.label}
								</label>
								<textarea
									id="message"
									name="message"
									rows="3"
									placeholder={t.contact.form.fields.message.placeholder}
									class="w-full px-4 py-2.5 rounded-lg bg-[var(--bg-input)] text-body border border-subtle focus:border-emphasis focus:outline-none focus:ring-2 focus:ring-[var(--brand-teal)]/50 transition-all resize-none text-sm"
								></textarea>
							</div>

							<!-- Submit Button -->
							<div>
								<button
									type="submit"
									class="w-full btn-primary px-6 py-3 rounded-full font-semibold transition-all hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
								>
									<span class="submit-text">{t.contact.form.button.submit}</span>
								</button>
							</div>

							<!-- Status Message -->
							<div id="form-status" class="mt-4 hidden">
								<p class="status-message text-sm"></p>
							</div>
						</form>
					</div>

					<!-- Contact Information -->
					<div class="space-y-6 animate-fade-in-up animate-delay-200">
					<!-- Email -->
					<div class="flex items-start gap-4">
						<div class="flex-shrink-0 w-12 h-12 bg-emerald-400/10 rounded-lg flex items-center justify-center glow">
							<svg class="w-6 h-6 text-[var(--brand-teal)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
							</svg>
						</div>
						<div>
							<h3 class="text-heading mb-1">{t.contact.email.label}</h3>
							<a href={`mailto:${t.contact.email.value}`} class="text-[var(--brand-teal)] hover:underline">
								{t.contact.email.value}
							</a>
						</div>
					</div>

					<!-- Address -->
					<div class="flex items-start gap-4">
						<div class="flex-shrink-0 w-12 h-12 bg-emerald-400/10 rounded-lg flex items-center justify-center glow">
							<svg class="w-6 h-6 text-[var(--brand-teal)]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
							</svg>
						</div>
						<div>
							<h3 class="text-heading mb-1">{t.contact.address.label}</h3>
							<p class="text-body">{t.contact.address.value}</p>
							<p class="text-body">{t.contact.address.detail}</p>
						</div>
					</div>
					</div>
				</div>

				<!-- Right Column: Map -->
				<div class="animate-fade-in-up animate-delay-300">
					<h3 class="text-heading mb-4">{t.contact.map.title}</h3>
					<div class="rounded-lg overflow-hidden shadow-lg h-[500px] border border-white/10">
						<iframe
							src="https://maps.google.com/maps?q=43+Janghan-ro,Dongdaemun-gu,Seoul,Korea&t=&z=15&ie=UTF8&iwloc=&output=embed"
							width="100%"
							height="100%"
							style="border:0;"
							allowfullscreen=""
							loading="lazy"
							referrerpolicy="no-referrer-when-downgrade"
						></iframe>
					</div>
					<div class="flex gap-4 mt-3 text-sm">
						<a href="https://map.naver.com/v5/search/서울특별시 동대문구 장한로 43" target="_blank" rel="noopener noreferrer" class="text-[var(--brand-teal)] hover:underline">
							View on Naver Map →
						</a>
						<a href="https://map.kakao.com/?q=서울특별시 동대문구 장한로 43" target="_blank" rel="noopener noreferrer" class="text-[var(--brand-teal)] hover:underline">
							View on Kakao Map →
						</a>
					</div>
				</div>
			</div>
		</div>
	</section>
</Layout>

<style>
	/* Form input focus states */
	input:focus,
	select:focus,
	textarea:focus {
		box-shadow: 0 0 0 3px rgba(30, 164, 161, 0.1);
	}

	/* Status message animations */
	#form-status {
		animation: fadeIn 0.3s ease-in;
	}

	#form-status.success .status-message {
		color: #31c27c;
		padding: 1rem;
		background: rgba(49, 194, 124, 0.1);
		border-radius: 0.5rem;
		border: 1px solid rgba(49, 194, 124, 0.3);
	}

	#form-status.error .status-message {
		color: #ef4444;
		padding: 1rem;
		background: rgba(239, 68, 68, 0.1);
		border-radius: 0.5rem;
		border: 1px solid rgba(239, 68, 68, 0.3);
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Placeholder styling for theme compatibility */
	::placeholder {
		color: var(--text-dim);
		opacity: 0.6;
	}
</style>

<!-- EmailJS SDK -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script is:inline define:vars={{
	serviceId: import.meta.env.PUBLIC_EMAILJS_SERVICE_ID,
	templateId: import.meta.env.PUBLIC_EMAILJS_TEMPLATE_ID,
	publicKey: import.meta.env.PUBLIC_EMAILJS_PUBLIC_KEY
}}>
	// EmailJS Configuration from environment variables
	const EMAILJS_SERVICE_ID = serviceId;
	const EMAILJS_TEMPLATE_ID = templateId;
	const EMAILJS_PUBLIC_KEY = publicKey;

	// Initialize EmailJS
	emailjs.init(EMAILJS_PUBLIC_KEY);

	// Form submission handler
	document.addEventListener('DOMContentLoaded', function() {
		const form = document.getElementById('order-form');
		const statusDiv = document.getElementById('form-status');
		const statusMessage = statusDiv.querySelector('.status-message');
		const submitButton = form.querySelector('button[type="submit"]');
		const submitText = submitButton.querySelector('.submit-text');

		form.addEventListener('submit', async function(e) {
			e.preventDefault();

			// Disable submit button
			submitButton.disabled = true;
			const originalText = submitText.textContent;
			submitText.textContent = 'Sending...';

			// Hide previous status
			statusDiv.classList.add('hidden');
			statusDiv.classList.remove('success', 'error');

			try {
				// Send email via EmailJS
				const response = await emailjs.sendForm(
					EMAILJS_SERVICE_ID,
					EMAILJS_TEMPLATE_ID,
					form
				);

				console.log('Email sent successfully:', response);

				// Show success message
				statusMessage.textContent = 'Your order inquiry has been sent successfully. We\'ll contact you soon!';
				statusDiv.classList.remove('hidden');
				statusDiv.classList.add('success');

				// Reset form
				form.reset();

				// Hide success message after 5 seconds
				setTimeout(() => {
					statusDiv.classList.add('hidden');
				}, 5000);

			} catch (error) {
				console.error('Email sending failed:', error);

				// Show error message
				statusMessage.textContent = 'An error occurred while sending. Please try again or email us directly.';
				statusDiv.classList.remove('hidden');
				statusDiv.classList.add('error');
			} finally {
				// Re-enable submit button
				submitButton.disabled = false;
				submitText.textContent = originalText;
			}
		});

		// Email validation for CC field
		const ccInput = document.getElementById('cc');
		ccInput.addEventListener('blur', function() {
			if (ccInput.value && !ccInput.validity.valid) {
				ccInput.setCustomValidity('Please enter a valid email address');
			} else {
				ccInput.setCustomValidity('');
			}
		});
	});
</script>

---
import '../styles/global.css';
import Layout from '../components/Layout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import { getTranslations } from '../content/translations';
import resourcesData from '../content/resources.json';

const t = getTranslations('en');
const lang = 'en';
const r = resourcesData;

// Generate FAQ Schema
const allFaqItems = [
	...r.faq.ordering.items,
	...r.faq.samplePrep.items,
	...r.faq.technical.items
];

const faqSchema = {
	"@context": "https://schema.org",
	"@type": "FAQPage",
	"mainEntity": allFaqItems.map(item => ({
		"@type": "Question",
		"name": item.question[lang],
		"acceptedAnswer": {
			"@type": "Answer",
			"text": item.answer[lang]
		}
	}))
};
---

<Layout lang="en" title={`${t.resources.title} - ${t.meta.title}`} description="FAQs and technical documentation for OmixAI's proteomics services. Learn about sample preparation, turnaround times, and analysis methods." currentPage="resources" lightHeader={false}>
	<style>
		details > summary {
			cursor: pointer;
			list-style: none;
			position: relative;
			padding-right: 2rem;
		}
		details > summary::-webkit-details-marker {
			display: none;
		}
		details > summary::after {
			content: '+';
			position: absolute;
			right: 0;
			top: 50%;
			transform: translateY(-50%);
			font-size: 1.5rem;
			font-weight: 300;
			color: var(--brand-teal);
			transition: all 0.3s ease;
		}
		details[open] > summary::after {
			content: '−';
			transform: translateY(-50%) rotate(180deg);
		}
		details[open] > summary {
			margin-bottom: 1rem;
		}
		.faq-item {
			border-bottom: 1px solid var(--border-subtle);
		}
		.faq-item:last-child {
			border-bottom: none;
		}
		.faq-content {
			display: grid;
			grid-template-rows: 0fr;
			transition: grid-template-rows 0.3s ease-out;
		}
		details[open] .faq-content {
			grid-template-rows: 1fr;
		}
		.faq-content > div {
			overflow: hidden;
		}
		.tab-button {
			transition: all 0.2s ease;
		}
		.tab-button.active {
			color: #31c27c;
			border-bottom-color: #31c27c;
		}
		.tab-panel {
			display: none;
		}
		.tab-panel.active {
			display: block;
		}
		</style>

	<!-- FAQ Schema -->
	<script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />

	<!-- Hero Section -->
	<section class="bg-section-alt py-16">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<Breadcrumb lang={lang} items={[{ name: t.nav.resources, url: '/resources' }]} />
			<div class="text-center">
				<h1 class="text-3xl md:text-4xl text-heading mb-3 animate-fade-in-up">
					{r.title[lang]}
				</h1>
				<p class="text-lg text-body animate-fade-in-up animate-delay-200">
					{r.subtitle[lang]}
				</p>
			</div>
		</div>
	</section>

	<!-- Tabs -->
	<section class="bg-section pt-8">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="flex justify-center gap-8 border-b border-white/10">
				<a
					href="#faq"
					class="tab-button active px-4 py-3 text-body border-b-2 border-transparent no-underline"
					data-tab="faq"
				>
					{r.tabs.faq[lang]}
				</a>
				<a
					href="#technical"
					class="tab-button px-4 py-3 text-body border-b-2 border-transparent no-underline"
					data-tab="technical"
				>
					{r.tabs.technical[lang]}
				</a>
				<a
					href="/notices"
					class="tab-button px-4 py-3 text-body border-b-2 border-transparent no-underline"
				>
					Notices
				</a>
			</div>
		</div>
	</section>

	<!-- FAQ Tab -->
	<section class="tab-panel active py-12 bg-section" id="faq-panel">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
			<h2 class="text-3xl text-center text-heading mb-12">{r.faq.title[lang]}</h2>

				<!-- Ordering & Pricing -->
				<div class="mb-12">
					<h3 class="text-2xl mb-6 text-body">{r.faq.ordering.title[lang]}</h3>
					<div>
						{r.faq.ordering.items.map((item) => (
							<details class="faq-item">
								<summary class="py-4 text-body hover:text-[var(--brand-teal)]">
									{item.question[lang]}
								</summary>
								<div class="faq-content">
									<div class="pb-4 text-muted">
										{item.answer[lang]}
									</div>
								</div>
							</details>
						))}
					</div>
				</div>

				<!-- Technical Details -->
				<div class="mb-12">
					<h3 class="text-2xl mb-6 text-body">{r.faq.technical.title[lang]}</h3>
					<div>
						{r.faq.technical.items.map((item) => (
							<details class="faq-item">
								<summary class="py-4 text-body hover:text-[var(--brand-teal)]">
									{item.question[lang]}
								</summary>
								<div class="faq-content">
									<div class="pb-4 text-muted">
										{item.answer[lang]}
									</div>
								</div>
							</details>
						))}
					</div>
				</div>

			<!-- CTA -->
			<div class="text-center mt-16">
				<p class="text-xl text-body mb-6">{r.faq.cta.question[lang]}</p>
				<a href="mailto:omixai@omixai.com" class="btn-primary inline-block px-8 py-4 rounded-full text-lg">
					{r.faq.cta.button[lang]}
				</a>
			</div>
		</div>
	</section>

	<!-- Technical Documentation Tab -->
	<section class="tab-panel py-12 bg-section" id="technical-panel">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
			<h2 class="text-3xl text-center text-heading mb-12">{r.technicalDocs.title[lang]}</h2>

			<!-- Platform Specs -->
			<div class="mb-12">
				<h3 class="text-2xl mb-6 text-body">{r.technicalDocs.platform.title[lang]}</h3>
				<div class="border-b border-subtle pb-6">
					<h4 class="text-lg text-heading mb-4">{r.technicalDocs.platform.name}</h4>
					<ul class="space-y-2 text-body">
						{r.technicalDocs.platform.specs.map((spec) => (
							<li>
								<strong class="text-body">{typeof spec.label === 'string' ? spec.label : spec.label[lang]}:</strong>{' '}
								{typeof spec.value === 'string' ? spec.value : spec.value[lang]}
							</li>
						))}
					</ul>
				</div>
			</div>

			<!-- Performance Metrics -->
			<div class="mb-12">
				<h3 class="text-2xl mb-6 text-body">{r.technicalDocs.performance.title[lang]}</h3>
				<div class="overflow-x-auto">
					<table class="w-full">
						<thead>
							<tr class="border-b border-subtle">
								<th class="text-left py-2 text-body">{r.technicalDocs.performance.headers.sampleType[lang]}</th>
								<th class="text-left py-2 text-body">{r.technicalDocs.performance.headers.proteins[lang]}</th>
							</tr>
						</thead>
						<tbody class="text-body">
							{r.technicalDocs.performance.rows.map((row, index) => (
								<tr class={index < r.technicalDocs.performance.rows.length - 1 ? "border-b border-subtle" : ""}>
									<td class="py-2">{row.sampleType[lang]}</td>
									<td class="py-2">{row.proteins}</td>
								</tr>
							))}
						</tbody>
					</table>
				</div>
			</div>

				<!-- Standard Deliverables -->
			<div class="mb-12">
				<h3 class="text-2xl mb-6 text-body">{r.technicalDocs.deliverables.title[lang]}</h3>
				<div class="space-y-6">
					{r.technicalDocs.deliverables.sections.map((section) => (
						<div>
							<h4 class="text-lg text-heading mb-3">{section.title[lang]}</h4>
							<ul class="space-y-2 text-body">
								{section.items.map((item) => (
									<li>• {item[lang]}</li>
								))}
							</ul>
						</div>
					))}
				</div>
			</div>

			<!-- CTA -->
			<div class="text-center mt-16">
				<p class="text-xl text-body mb-6">{r.technicalDocs.cta.question[lang]}</p>
				<a href="mailto:omixai@omixai.com" class="btn-primary inline-block px-8 py-4 rounded-full text-lg">
					{r.technicalDocs.cta.button[lang]}
				</a>
			</div>
		</div>
	</section>

	<script>
		// Tab switching functionality
		const tabButtons = document.querySelectorAll('.tab-button');
		const tabPanels = document.querySelectorAll('.tab-panel');

		function switchTab(tabName: string) {
			// Remove active class from all buttons and panels
			tabButtons.forEach(btn => btn.classList.remove('active'));
			tabPanels.forEach(panel => panel.classList.remove('active'));

			// Add active class to clicked button and corresponding panel
			const activeButton = document.querySelector(`[data-tab="${tabName}"]`);
			const activePanel = document.getElementById(`${tabName}-panel`);

			if (activeButton && activePanel) {
				activeButton.classList.add('active');
				activePanel.classList.add('active');
			}
		}

		// Handle hash changes
		function handleHashChange() {
			const hash = window.location.hash.slice(1); // Remove the '#'
			if (hash === 'faq' || hash === 'technical') {
				switchTab(hash);
			} else {
				switchTab('faq'); // Default to FAQ
			}
		}

		// Listen for hash changes
		window.addEventListener('hashchange', handleHashChange);

		// Initialize on page load
		handleHashChange();
	</script>
</Layout>
